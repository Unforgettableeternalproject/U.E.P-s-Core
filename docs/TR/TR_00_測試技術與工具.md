# TR-00: 測試技術與工具說明
## Software Testing Techniques & Tools

| 項目 | 內容 |
|:---|:---|
| **專案名稱** | U.E.P (Unified Experience Partner) |
| **撰寫日期** | 2025-12-22 |
| **專案負責人** | Bernie |
| **當前版本** | v0.9.4-stable |
| **測試平台** | Windows 10 (win32) |

---

## 1. 測試工具與框架 (Testing Tools & Frameworks)

### 1.1 核心測試工具清單

| 工具名稱 | 版本 | 用途 | 官方網站 |
|:---|:---|:---|:---|
| **pytest** | 8.3.3 | 主要測試框架 | https://pytest.org |
| **pytest-asyncio** | 0.26.0 | 異步測試支援 | https://github.com/pytest-dev/pytest-asyncio |
| **pytest-cov** | 5.0.0 | 測試覆蓋率分析 | https://pytest-cov.readthedocs.io |
| **unittest** | 內建 | 單元測試基礎 | https://docs.python.org/3/library/unittest.html |
| **unittest.mock** | 內建 | Mock/Stub 功能 | https://docs.python.org/3/library/unittest.mock.html |
| **GitHub Actions** | - | CI/CD 平台 | https://github.com/features/actions |

### 1.2 測試框架特性比較

| 特性 | pytest | unittest | 說明 |
|:---|:---:|:---:|:---|
| **簡潔語法** | ✅ | ❌ | pytest 使用 assert，unittest 使用 self.assertEqual |
| **Fixture 系統** | ✅ | ⚠️ | pytest fixture 更強大 |
| **異步支援** | ✅ | ⚠️ | pytest-asyncio 提供完整支援 |
| **參數化測試** | ✅ | ❌ | pytest.mark.parametrize |
| **插件生態** | ✅ | ❌ | pytest 擁有豐富插件 |
| **報告生成** | ✅ | ⚠️ | pytest-html 等插件 |

---

## 2. 測試策略與方法 (Testing Strategies)

### 2.1 測試層級

| 測試層級 | 測試數量 | 覆蓋範圍 | 執行頻率 |
|:---|:---:|:---|:---|
| **單元測試** | 362 | 個別函數/類別 | 每次提交 |
| **整合測試** | 46 | 模組間協作 | 每日 |
| **系統測試** | 15 | 端到端流程 | 每週 |
| **功能測試** | 43 | 使用者場景 | 每次發布前 |
| **效能測試** | 12 | 效能指標 | 每月 |

### 2.2 測試覆蓋目標

| 項目 | 目標 | 當前狀態 | 達成率 |
|:---|:---:|:---:|:---:|
| **程式碼覆蓋率** | 85% | 85% | ✅ 100% |
| **分支覆蓋率** | 80% | 80% | ✅ 100% |
| **核心功能覆蓋** | 100% | 100% | ✅ 100% |
| **整合測試覆蓋** | 90% | 75% | ⚠️ 83% |

---

## 3. 測試執行環境 (Test Environment)

### 3.1 硬體環境

| 項目 | 規格 | 說明 |
|:---|:---|:---|
| **CPU** | Intel Core i7 / AMD Ryzen 7 | 多核心處理器 |
| **RAM** | 16GB+ | 支援多會話測試 |
| **GPU** | NVIDIA GTX 1660 / RTX 3060 | CUDA 支援 |
| **儲存** | SSD 512GB+ | 快速讀寫 |

### 3.2 軟體環境

| 項目 | 版本 | 說明 |
|:---|:---|:---|
| **作業系統** | Windows 10/11 (Build 19045+) | 主要測試平台 |
| **Python** | 3.10.11 | 專案 Python 版本 |
| **虛擬環境** | venv (env/) | 隔離測試環境 |
| **依賴管理** | requirements.txt | 完整套件列表 |

### 3.3 外部服務

| 服務 | 用途 | 必要性 |
|:---|:---|:---:|
| **Google Gemini API** | LLM 推理 | 必要 |
| **網路連線** | RSS Feed, 天氣 API | 選用 |
| **Tesseract OCR** | OCR 測試 | 選用 |
| **ChromeDriver** | Selenium 測試 | 選用 |

---

## 4. 測試度量指標 (Test Metrics)

### 4.1 主要度量指標

| 指標 | 定義 | 目標值 | 當前值 |
|:---|:---|:---:|:---:|
| **測試通過率** | 通過測試 / 總測試 | ≥ 90% | 77.1% |
| **程式碼覆蓋率** | 已測試程式碼 / 總程式碼 | ≥ 85% | 85% |
| **缺陷密度** | 缺陷數 / KLOC | ≤ 5 | 3.2 |
| **平均修復時間** | 缺陷修復平均時間 | ≤ 48h | - |

### 4.2 品質閾值

| 閾值類型 | 標準 | 說明 |
|:---|:---|:---|
| **測試通過率** | ≥ 90% | 低於此值不可發布 |
| **P0 缺陷** | 0 | 嚴重缺陷不可發布 |
| **P1 缺陷** | ≤ 2 | 需有明確修復計劃 |
| **程式碼覆蓋率** | ≥ 85% | 核心模組需 ≥ 90% |

---

## 5. CI/CD 整合 (CI/CD Integration)

### 5.1 GitHub Actions 工作流程

| 工作流程 | 觸發條件 | 執行內容 |
|:---|:---|:---|
| **release.yml** | PR merge 到 main | 自動打版本 tag |
| **auto-version-tag.yml** | 手動/定時 | 自動版本管理 |
| **hotfix-tag.yml** | Hotfix 分支 | 緊急修復流程 |
| **update-version-history.yml** | 版本變更 | 更新版本歷史 |

### 5.2 建議新增的 CI 工作流程

| 工作流程 | 觸發條件 | 執行內容 | 優先級 |
|:---|:---|:---|:---:|
| **python-tests.yml** | push/PR | 執行所有測試 | P1 |
| **code-quality.yml** | push/PR | 程式碼品質檢查 | P2 |
| **coverage-report.yml** | 每日 02:00 | 生成覆蓋率報告 | P2 |
| **deploy.yml** | tag 建立 | 自動部署 | P3 |

---

## 6. 測試文檔結構 (Test Documentation)

### 6.1 測試報告清單

| 報告編號 | 報告名稱 | 狀態 | 頁數 |
|:---|:---|:---:|---:|
| TR-00 | 測試技術與工具 | ✅ Complete | 此文件 |
| TR-01 | 單元測試報告 | ✅ Complete | 181 行 |
| TR-02 | 系統測試報告 | ✅ Complete | ~150 行 |
| TR-03 | 功能測試報告 | ✅ Complete | ~150 行 |
| TR-04 | 整合測試報告 | 🔄 In Progress | - |
| TR-05 | 效能測試報告 | 🔄 In Progress | - |
| TR-06 | CI 測試報告 | ✅ Complete | ~100 行 |
| TR-07 | 問題追蹤報告 | ✅ Complete | ~120 行 |

### 6.2 測試文檔追溯

| 文檔類型 | 對應測試報告 | 說明 |
|:---|:---|:---|
| **需求文檔 (SDD)** | All TR | 功能需求追溯 |
| **設計文檔 (SDD)** | TR-01, TR-02 | 設計實現驗證 |
| **使用者手冊** | TR-03 | 使用者場景驗證 |
| **API 文檔** | TR-01, TR-04 | API 功能驗證 |

---

## 7. 測試最佳實踐 (Best Practices)

### 7.1 測試撰寫原則

| 原則 | 說明 | 範例 |
|:---|:---|:---|
| **獨立性** | 測試間不相互依賴 | 使用 fixture 隔離狀態 |
| **可重複性** | 多次執行結果一致 | 避免依賴外部狀態 |
| **清晰命名** | 測試名稱說明測試內容 | test_event_bus_publishes_event |
| **單一職責** | 一個測試驗證一件事 | 分離多個 assert |
| **快速執行** | 單元測試應快速完成 | < 100ms per test |

### 7.2 Fixture 使用建議

| Fixture 類型 | 使用場景 | 範例 |
|:---|:---|:---|
| **function** | 每個測試獨立 | 事件總線實例 |
| **class** | 測試類共享 | 測試配置 |
| **module** | 模組級共享 | 資料庫連線 |
| **session** | 整個會話共享 | 測試資料 |

---

## 8. 附錄 (Appendix)

### 8.1 測試執行指令

```bash
# 執行所有單元測試
pytest unit_tests/ -v

# 執行所有整合測試
pytest integration_tests/ -v

# 生成覆蓋率報告
pytest --cov=core --cov=modules --cov-report=html

# 執行特定測試
pytest unit_tests/test_event_bus.py -v

# 執行標記的測試
pytest -m "not slow" -v
```

### 8.2 常用 pytest 標記

| 標記 | 用途 | 使用方式 |
|:---|:---|:---|
| `@pytest.mark.asyncio` | 異步測試 | 標記 async def 測試 |
| `@pytest.mark.slow` | 慢速測試 | 標記執行時間 > 1s |
| `@pytest.mark.parametrize` | 參數化測試 | 提供多組測試數據 |
| `@pytest.mark.skip` | 跳過測試 | 暫時禁用測試 |
| `@pytest.mark.xfail` | 預期失敗 | 標記已知失敗 |

---

**報告版本**: 1.0  
**最後更新**: 2025-12-22  
**下一份報告**: [TR-01 單元測試報告](./TR_01_單元測試報告.md)
