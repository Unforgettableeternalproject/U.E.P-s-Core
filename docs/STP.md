# U.E.P (Unified Experience Partner) 系統

## 系統測試計畫
### System Test Plan (STP)

| 項目 | 內容 |
| :---: | :---- |
| 專案名稱 | U.E.P (Unified Experience Partner) |
| 專案代號 | UEP-Core |
| 撰寫日期 | 2025-11-07 |
| 測試負責人 | Bernie |
| 當前版本 | v2.0 (Phase 2 - Event-Driven Architecture) |
| Python 版本 | Python 3.10+ |

---

## 版次變更記錄

| 版次 | 變更項目 | 變更日期 |
| :---: | :---- | :---: |
| 1.0 | 初版 (Phase 2 系統測試計畫) | 2025-11-07 |
|  |  |  |
|  |  |  |
|  |  |  |

---

## 目錄

1. [測試概述](#1-測試概述)
2. [測試環境](#2-測試環境)
3. [測試資源與成員](#3-測試資源與成員)
4. [測試策略](#4-測試策略)
5. [測試案例設計](#5-測試案例設計)
6. [需求追溯矩陣](#6-需求追溯矩陣)
7. [測試時程](#7-測試時程)
8. [缺陷管理](#8-缺陷管理)

---

## 1. 測試概述

### 1.1 測試目標

本測試計畫旨在確保 U.E.P 系統 Phase 2 (事件驅動架構) 的品質,具體目標包括:

- **功能完整性**: 驗證所有功能需求正確實現
- **系統穩定性**: 確保系統長時間運行無崩潰、記憶體洩漏
- **性能達標**: 驗證系統啟動時間、回應時間符合目標
- **整合正確性**: 確保模組間協作流程正確無誤
- **錯誤處理**: 驗證異常情況下的系統行為

### 1.2 測試範疇

#### 包含範疇

**核心系統**:
- Event Bus (事件匯流排)
- Module Coordinator (模組協調器)
- Session Manager (三層會話管理)
- State Manager (狀態管理)
- Working Context (工作上下文)

**功能模組** (9個):
1. STT Module (語音轉文字)
2. NLP Module (自然語言處理)
3. MEM Module (記憶管理)
4. LLM Module (大型語言模型)
5. SYS Module (系統功能)
6. TTS Module (文字轉語音)
7. UI Module (使用者介面)
8. MOV Module (移動控制)
9. ANI Module (動畫引擎)

**系統流程**:
- CHAT 模式完整流程
- WORK 模式完整流程
- 系統啟動與初始化
- 錯誤處理與回復

#### 不包含範疇

- 正式部署環境測試 (Phase 3)
- 壓力測試 (規劃於性能優化階段)
- 安全性測試 (規劃於後續版本)
- 多使用者並發測試 (不在 Phase 2 範疇)

### 1.3 測試方法

| 測試類型 | 測試方法 | 工具 | 責任 |
|:---|:---|:---|:---:|
| **單元測試** | 自動化測試 | pytest | 開發者 |
| **整合測試** | 自動化 + 手動 | pytest, 日誌分析 | 開發者 |
| **系統測試** | 手動測試 | 實際執行, Debug GUI | 測試者 |
| **性能測試** | 工具測試 | 時間戳分析, profiler | 開發者 |

---

## 2. 測試環境

### 2.1 硬體環境

#### 最低需求

| 硬體項目 | 規格 |
|:---|:---|
| **CPU** | Intel i5 / AMD Ryzen 5 |
| **GPU** | NVIDIA RTX 3060 (6GB VRAM) |
| **RAM** | 16GB |
| **Storage** | 20GB 可用空間 (SSD 建議) |
| **網路** | 穩定網路連線 (Gemini API, 模型下載) |

#### 建議環境 (開發與測試)

| 硬體項目 | 規格 |
|:---|:---|
| **CPU** | Intel i7 / AMD Ryzen 7 |
| **GPU** | NVIDIA RTX 4060/4070 (8GB+ VRAM) |
| **RAM** | 32GB |
| **Storage** | 50GB SSD |
| **網路** | 高速網路連線 |

### 2.2 軟體環境

#### 作業系統

| 平台 | 版本 | 測試優先級 |
|:---|:---|:---:|
| **Windows** | 10/11 | 主要 (✅) |
| **Linux** | Ubuntu 20.04+ | 次要 (📅) |

#### 核心軟體

| 軟體 | 版本 | 用途 |
|:---|:---|:---|
| **Python** | 3.10+ | 主要開發語言 |
| **CUDA Toolkit** | 12.8 | GPU 加速 |
| **PyTorch** | 2.7.0 + cu128 | 深度學習框架 |
| **Git** | 最新版 | 版本控制 |

#### Python 虛擬環境

```bash
# Windows PowerShell
.\env\Scripts\Activate.ps1

# Linux/macOS
source env/bin/activate
```

### 2.3 配置需求

#### 系統配置 (`configs/config.yaml`)

```yaml
modules_enabled:
  stt_module: true
  nlp_module: true
  mem_module: true
  llm_module: true
  tts_module: true
  sys_module: true
  ui_module: true
  ani_module: true
  mov_module: true

logging:
  enabled: true
  log_level: DEBUG  # 測試環境使用 DEBUG
  log_dir: logs
  enable_split_logs: false
```

#### 環境變數

| 變數名稱 | 用途 | 必要性 |
|:---|:---|:---:|
| `GEMINI_API_KEY` | Google Gemini API 金鑰 | 必要 |
| `HF_TOKEN` | Hugging Face Token (模型下載) | 建議 |

### 2.4 模型檔案需求

| 模型類型 | 存放位置 | 大小 | 取得方式 |
|:---|:---|:---:|:---|
| **NLP 模型** | `models/nlp/` | ~100MB | 自訓練模型 |
| **STT 模型** | `models/stt/` | ~1-2GB | Whisper, Pyannote (Hugging Face) |
| **TTS 模型** | `models/tts/` | ~2-4GB | IndexTTS 模型 |

**模型下載確認**:
- 首次執行前確保所有模型已下載完成
- 使用 `python -c "from modules.stt_module import check_models; check_models()"` 檢查

### 2.5 外部服務

| 服務 | 用途 | 測試前準備 |
|:---|:---|:---|
| **Google Gemini API** | LLM 對話生成 | 確保 API Key 有效,配額充足 |
| **Hugging Face Hub** | 模型下載 | 確保網路連線正常 |

---

## 3. 測試資源與成員

### 3.1 測試團隊

| 成員 | 角色 | 職責 |
|:---|:---|:---|
| Bernie | 測試負責人<br>主要測試者 | 測試計劃、測試執行、缺陷追蹤、測試報告 |
| yutao33003 | 協助測試者 | 協助測試執行、問題回報 |

### 3.2 測試設備分配

| 設備類型 | 規格 | 用途 | 負責人 |
|:---|:---|:---|:---:|
| **主要測試機** | RTX 4060, 32GB RAM | 完整功能測試 | Bernie |
| **次要測試機** | RTX 3060, 16GB RAM | 最低需求驗證 | (規劃中) |

### 3.3 測試數據準備

#### 語音測試數據

| 數據類型 | 數量 | 來源 | 用途 |
|:---|:---:|:---|:---|
| **短語音片段** | 10+ | 錄製 | STT 基礎測試 |
| **長語音片段** | 5+ | 錄製 | STT 長文本測試 |
| **多說話者語音** | 5+ | 錄製 | Speaker ID 測試 |
| **雜訊語音** | 5+ | 錄製 | 魯棒性測試 |

#### 文字測試數據

| 數據類型 | 數量 | 來源 | 用途 |
|:---|:---:|:---|:---|
| **CHAT 意圖句子** | 20+ | 設計 | NLP Intent 測試 |
| **WORK 意圖句子** | 20+ | 設計 | NLP Intent 測試 |
| **複合意圖句子** | 10+ | 設計 | NLP 複合意圖測試 |
| **邊界案例** | 10+ | 設計 | NLP 魯棒性測試 |

#### 記憶測試數據

| 數據類型 | 數量 | 來源 | 用途 |
|:---|:---:|:---|:---|
| **記憶條目** | 100+ | 生成 | MEM 檢索測試 |
| **多身份記憶** | 50+ | 生成 | Identity 隔離測試 |

---

## 4. 測試策略

### 4.1 測試層級

```
┌─────────────────────────────────────┐
│      系統測試 (System Test)          │  ← 端到端測試
│  CHAT/WORK 完整流程, 性能測試         │
├─────────────────────────────────────┤
│      整合測試 (Integration Test)     │  ← 模組間協作
│  Input → Processing → Output         │
├─────────────────────────────────────┤
│      單元測試 (Unit Test)            │  ← 模組內部
│  各模組功能測試                      │
└─────────────────────────────────────┘
```

### 4.2 測試優先級

| 優先級 | 測試範圍 | 說明 |
|:---:|:---|:---|
| **P0** | 核心流程 | CHAT/WORK 模式基本功能,系統啟動 |
| **P1** | 重要功能 | 記憶檢索、工作流引擎、情緒控制 |
| **P2** | 次要功能 | 前端整合、動畫效果 |
| **P3** | 邊界案例 | 錯誤處理、異常情況 |

### 4.3 測試覆蓋率目標

| 測試類型 | 目標覆蓋率 | 衡量標準 |
|:---|:---:|:---|
| **單元測試** | > 80% | pytest-cov 程式碼覆蓋率 |
| **整合測試** | > 70% | 關鍵整合點覆蓋 |
| **系統測試** | 100% | 所有 P0/P1 功能測試 |

### 4.4 測試自動化策略

| 測試類型 | 自動化程度 | 工具 |
|:---|:---:|:---|
| **單元測試** | 100% 自動化 | pytest |
| **整合測試** | 80% 自動化 | pytest + 手動驗證 |
| **系統測試** | 50% 自動化 | 手動測試為主 |
| **性能測試** | 70% 自動化 | 腳本 + profiler |

---

## 5. 測試案例設計

### 5.1 單元測試案例

#### TC-STT-001: STT 模組基礎轉錄測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-STT-001 |
| **測試名稱** | STT 基礎語音轉錄 |
| **測試目的** | 驗證 Whisper 模型正確轉錄短語音 |
| **前置條件** | 1. STT 模組已初始化<br>2. Whisper 模型已載入 |
| **測試步驟** | 1. 載入測試語音檔 (5秒中文短語)<br>2. 調用 `stt_module.transcribe(audio_data)`<br>3. 檢查返回結果 |
| **預期結果** | 1. 返回 STTOutput Schema<br>2. `text` 欄位包含正確轉錄文字<br>3. `confidence` > 0.8 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | FR-1: 語音輸入 |

#### TC-STT-002: STT 說話者識別測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-STT-002 |
| **測試名稱** | 說話者識別 (Speaker Diarization) |
| **測試目的** | 驗證 Pyannote 正確識別說話者 ID |
| **前置條件** | 1. STT 模組已初始化<br>2. Pyannote 模型已載入 |
| **測試步驟** | 1. 載入已知說話者語音<br>2. 調用 `stt_module.transcribe(audio_data)`<br>3. 檢查 `speaker_id` |
| **預期結果** | 1. `speaker_id` 不為空<br>2. 相同說話者返回相同 ID<br>3. 不同說話者返回不同 ID |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | FR-1: 語音輸入 - 說話者識別 |

#### TC-NLP-001: NLP 意圖分析測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-NLP-001 |
| **測試名稱** | CHAT 意圖識別 |
| **測試目的** | 驗證 NLP 正確識別 CHAT 意圖 |
| **前置條件** | NLP 模組已初始化 |
| **測試步驟** | 1. 輸入測試文字: "你好,今天天氣如何?"<br>2. 調用 `nlp_module.analyze(text)`<br>3. 檢查 `primary_intent` |
| **預期結果** | `primary_intent` == `IntentType.CHAT` |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | FR-2: 自然語言理解 - 意圖分析 |

#### TC-MEM-001: MEM 記憶存儲測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-MEM-001 |
| **測試名稱** | 記憶條目存儲 |
| **測試目的** | 驗證記憶正確存儲到 FAISS |
| **前置條件** | MEM 模組已初始化 |
| **測試步驟** | 1. 創建測試記憶條目<br>2. 調用 `mem_module.store_memory(entry)`<br>3. 查詢 FAISS 索引 |
| **預期結果** | 1. 記憶成功存儲<br>2. 索引數量增加<br>3. 可檢索到存儲的記憶 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | FR-3: 記憶管理 - 記憶存儲 |

#### TC-MEM-002: MEM 身份隔離測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-MEM-002 |
| **測試名稱** | Memory Token 身份隔離 |
| **測試目的** | 驗證不同身份記憶正確隔離 |
| **前置條件** | MEM 模組已初始化 |
| **測試步驟** | 1. 存儲 Alice 的記憶<br>2. 存儲 Bob 的記憶<br>3. 以 Alice Token 查詢<br>4. 以 Bob Token 查詢 |
| **預期結果** | 1. Alice 查詢只返回 Alice 記憶<br>2. Bob 查詢只返回 Bob 記憶<br>3. 無交叉洩漏 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | FR-3: 記憶管理 - 身份隔離 |

#### TC-LLM-001: LLM Gemini API 調用測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-LLM-001 |
| **測試名稱** | Gemini API 基礎調用 |
| **測試目的** | 驗證 Gemini API 正常回應 |
| **前置條件** | 1. LLM 模組已初始化<br>2. API Key 有效 |
| **測試步驟** | 1. 構建測試 Prompt<br>2. 調用 `llm_module.generate(prompt)`<br>3. 檢查回應 |
| **預期結果** | 1. API 調用成功<br>2. 返回有效回應文字<br>3. 無 API 錯誤 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | FR-4: LLM 對話 - Gemini 整合 |

#### TC-SYS-001: SYS 工作流執行測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-SYS-001 |
| **測試名稱** | 工作流基礎執行 |
| **測試目的** | 驗證 Workflow Engine 正確執行工作流 |
| **前置條件** | SYS 模組已初始化 |
| **測試步驟** | 1. 創建測試工作流 (3步驟)<br>2. 調用 `sys_module.start_workflow(workflow_type)`<br>3. 監控執行狀態 |
| **預期結果** | 1. 工作流啟動成功<br>2. 所有步驟順序執行<br>3. 最終狀態為 COMPLETED |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | FR-6: 系統功能 - 工作流自動化 |

#### TC-TTS-001: TTS 語音合成測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-TTS-001 |
| **測試名稱** | IndexTTS 語音合成 |
| **測試目的** | 驗證 TTS 正確合成語音 |
| **前置條件** | 1. TTS 模組已初始化<br>2. IndexTTS 模型已載入 |
| **測試步驟** | 1. 輸入測試文字: "你好,我是 U.E.P"<br>2. 調用 `tts_module.synthesize(text)`<br>3. 檢查輸出音訊 |
| **預期結果** | 1. 成功生成音訊檔<br>2. 音訊長度 > 0<br>3. 可正常播放 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | FR-5: 語音輸出 |

#### TC-TTS-002: TTS 情緒控制測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-TTS-002 |
| **測試名稱** | 8D 情緒向量控制 |
| **測試目的** | 驗證情緒參數正確影響語音 |
| **前置條件** | TTS 模組已初始化 |
| **測試步驟** | 1. 設定情緒: happy=0.8<br>2. 合成語音<br>3. 比較不同情緒參數結果 |
| **預期結果** | 1. 情緒參數成功傳遞<br>2. 不同情緒產生不同語音特徵<br>3. Pride 雙向映射正確 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | FR-5: 語音輸出 - 情緒控制 |

### 5.2 整合測試案例

#### TC-INT-001: STT → NLP 整合測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-INT-001 |
| **測試名稱** | 語音輸入到意圖分析 |
| **測試目的** | 驗證 STT 輸出正確傳遞給 NLP |
| **前置條件** | STT, NLP 模組已初始化 |
| **測試步驟** | 1. 錄製語音: "幫我歸檔文件"<br>2. STT 轉錄<br>3. NLP 分析<br>4. 檢查 Event Bus 事件流 |
| **預期結果** | 1. STT 成功轉錄<br>2. NLP 識別為 WORK 意圖<br>3. 發布 INPUT_LAYER_COMPLETE 事件 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | 系統流程 - 輸入層整合 |

#### TC-INT-002: MEM → LLM 整合測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-INT-002 |
| **測試名稱** | 記憶檢索到 LLM 生成 |
| **測試目的** | 驗證記憶正確注入 LLM Prompt |
| **前置條件** | MEM, LLM 模組已初始化 |
| **測試步驟** | 1. 預先存儲測試記憶<br>2. 觸發 CHAT 模式<br>3. 檢查 Working Context CHAT_MEM<br>4. 驗證 LLM Prompt 包含記憶 |
| **預期結果** | 1. MEM 成功檢索記憶<br>2. CHAT_MEM 通道包含記憶摘要<br>3. LLM 生成考慮記憶內容 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | 系統流程 - CHAT 模式 |

#### TC-INT-003: LLM → SYS MCP 整合測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-INT-003 |
| **測試名稱** | LLM Function Calling 到 SYS |
| **測試目的** | 驗證 MCP 協議正確調用 SYS 工具 |
| **前置條件** | LLM, SYS 模組已初始化 |
| **測試步驟** | 1. 輸入 WORK 任務<br>2. LLM 生成 Function Call<br>3. MCP Client 解析<br>4. SYS 執行工作流 |
| **預期結果** | 1. LLM 正確生成 start_workflow 調用<br>2. MCP Client 成功解析<br>3. SYS 啟動對應工作流 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | 系統流程 - WORK 模式 |

### 5.3 系統測試案例

#### TC-SYS-001: CHAT 模式端到端測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-SYS-001 |
| **測試名稱** | CHAT 模式完整流程 |
| **測試目的** | 驗證 CHAT 模式從語音到回應完整流程 |
| **前置條件** | 系統完整啟動,所有模組健康 |
| **測試步驟** | 1. 系統處於 IDLE 狀態<br>2. 說話: "你好,今天天氣如何?"<br>3. 等待系統回應<br>4. 檢查整個流程 |
| **預期結果** | 1. STT 正確轉錄<br>2. NLP 識別為 CHAT<br>3. MEM 檢索相關記憶<br>4. LLM 生成合理回應<br>5. TTS 語音輸出<br>6. 系統回到 IDLE |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | 📅 規劃中 |
| **對應需求** | FR-1, FR-2, FR-3, FR-4, FR-5 |

#### TC-SYS-002: WORK 模式端到端測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-SYS-002 |
| **測試名稱** | WORK 模式完整流程 |
| **測試目的** | 驗證 WORK 模式工作流自動化流程 |
| **前置條件** | 系統完整啟動,所有模組健康 |
| **測試步驟** | 1. 系統處於 IDLE<br>2. 說話: "幫我歸檔桌面的文件"<br>3. 等待工作流執行<br>4. LLM 審核步驟<br>5. 確認完成 |
| **預期結果** | 1. NLP 識別為 WORK<br>2. LLM 調用 start_workflow<br>3. SYS 執行工作流<br>4. Interactive Step 等待審核<br>5. LLM 批准後繼續<br>6. 工作流完成 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | 📅 規劃中 |
| **對應需求** | FR-1, FR-2, FR-4, FR-6 |

#### TC-SYS-003: 系統啟動測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-SYS-003 |
| **測試名稱** | 系統 7 階段初始化 |
| **測試目的** | 驗證系統正確啟動,所有模組載入 |
| **前置條件** | 無 (系統未啟動) |
| **測試步驟** | 1. 執行 `python Entry.py`<br>2. 監控啟動流程<br>3. 檢查模組健康狀態<br>4. 記錄啟動時間 |
| **預期結果** | 1. 7 階段順序執行<br>2. 所有模組 health_check 通過<br>3. 啟動時間 < 40秒<br>4. 系統進入 IDLE 狀態 |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | ⏳ 待執行 |
| **對應需求** | NFR-1: 性能 - 啟動時間 |

### 5.4 性能測試案例

#### TC-PERF-001: 系統啟動時間測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-PERF-001 |
| **測試名稱** | 系統啟動性能 |
| **測試目的** | 測量並驗證系統啟動時間 |
| **前置條件** | 系統未啟動 |
| **測試步驟** | 1. 記錄啟動開始時間<br>2. 執行系統啟動<br>3. 記錄就緒時間<br>4. 計算耗時 |
| **預期結果** | 總啟動時間 < 40秒 |
| **實際結果** | 當前約 37秒 (TTS 載入 35秒) |
| **測試狀態** | ✅ 通過 |
| **對應需求** | NFR-1: 性能 |

#### TC-PERF-002: CHAT 回應時間測試

| 項目 | 內容 |
|:---|:---|
| **測試編號** | TC-PERF-002 |
| **測試名稱** | CHAT 模式回應時間 |
| **測試目的** | 測量 CHAT 模式端到端回應時間 |
| **前置條件** | 系統已啟動並處於 IDLE |
| **測試步驟** | 1. 記錄語音開始時間<br>2. 執行 CHAT 流程<br>3. 記錄 TTS 開始播放時間<br>4. 計算耗時 |
| **預期結果** | 端到端回應時間 < 3秒 (不含語音輸入時間) |
| **實際結果** | (測試執行後填寫) |
| **測試狀態** | 📅 規劃中 |
| **對應需求** | NFR-1: 性能 |

---

## 6. 需求追溯矩陣

### 6.1 功能需求追溯

| 需求編號 | 需求描述 | 對應模組 | 測試案例 | 測試狀態 |
|:---:|:---|:---:|:---|:---:|
| **FR-1** | 語音輸入 (STT) | STT Module | TC-STT-001, TC-STT-002, TC-INT-001 | ⏳ |
| **FR-2** | 自然語言理解 (NLP) | NLP Module | TC-NLP-001, TC-INT-001 | ⏳ |
| **FR-3** | 記憶管理 (MEM) | MEM Module | TC-MEM-001, TC-MEM-002, TC-INT-002 | ⏳ |
| **FR-4** | LLM 對話 (LLM) | LLM Module | TC-LLM-001, TC-INT-002, TC-INT-003 | ⏳ |
| **FR-5** | 語音輸出 (TTS) | TTS Module | TC-TTS-001, TC-TTS-002 | ⏳ |
| **FR-6** | 系統功能 (SYS) | SYS Module | TC-SYS-001, TC-INT-003 | ⏳ |
| **FR-7** | 桌面介面 (UI) | UI Module | (規劃中) | 📅 |
| **FR-8** | 動畫系統 (ANI) | ANI Module | (規劃中) | 📅 |
| **FR-9** | 移動控制 (MOV) | MOV Module | (規劃中) | 📅 |

### 6.2 非功能需求追溯

| 需求編號 | 需求描述 | 驗收標準 | 測試案例 | 測試狀態 |
|:---:|:---|:---|:---|:---:|
| **NFR-1** | 性能需求 | 啟動 < 40秒, CHAT < 3秒 | TC-PERF-001, TC-PERF-002 | ⏳ |
| **NFR-2** | 可靠性 | 模組健康檢查,錯誤回復 | TC-SYS-003, (錯誤處理測試) | ⏳ |
| **NFR-3** | 可維護性 | 模組化架構,清晰文檔 | 程式碼審查, SDD 完整性 | ✅ |
| **NFR-4** | 擴展性 | 動態模組載入 | 模組註冊測試 | ✅ |

### 6.3 測試覆蓋矩陣

| 模組 | 單元測試 | 整合測試 | 系統測試 | 覆蓋率 |
|:---|:---:|:---:|:---:|:---:|
| **STT** | ✅ | ✅ | ⏳ | 85% |
| **NLP** | ✅ | ✅ | ⏳ | 80% |
| **MEM** | ✅ | ✅ | ⏳ | 85% |
| **LLM** | ✅ | ✅ | ⏳ | 75% |
| **SYS** | ✅ | ✅ | ⏳ | 80% |
| **TTS** | ✅ | ✅ | ⏳ | 80% |
| **UI** | 📅 | 📅 | 📅 | 30% |
| **MOV** | 📅 | 📅 | 📅 | 25% |
| **ANI** | 📅 | 📅 | 📅 | 25% |

**圖例**: ✅ 完成 | ⏳ 進行中 | 📅 規劃中

---

## 7. 測試時程

### 7.1 測試階段規劃

| 階段 | 測試類型 | 預定時間 | 測試範圍 | 負責人 |
|:---:|:---|:---:|:---|:---:|
| **階段 1** | 單元測試 | P2.2 ~ P2.4 | 各模組內部功能 | Bernie |
| **階段 2** | 整合測試 | P2.5 | 模組間協作 | Bernie |
| **階段 3** | 系統測試 | P2.5 | 端到端流程 | Bernie |
| **階段 4** | 性能測試 | P2.6 | 性能指標驗證 | Bernie |
| **階段 5** | 驗收測試 | v2.0.0 發布前 | 所有需求驗證 | Bernie |

### 7.2 測試執行時程

#### 階段 1: 單元測試 (已進行)

| 模組 | 測試時間 | 狀態 | 備註 |
|:---|:---:|:---:|:---|
| STT | P2.2 | ✅ | 已完成基礎測試 |
| NLP | P2.2 | ✅ | 已完成基礎測試 |
| MEM | P2.3 | ✅ | 已完成基礎測試 |
| LLM | P2.3 | ✅ | 已完成基礎測試 |
| SYS | P2.3 | ✅ | 已完成基礎測試 |
| TTS | P2.4 | ✅ | 已完成基礎測試 |
| UI/MOV/ANI | P2.4 | 📅 | 規劃中 |

#### 階段 2: 整合測試 (進行中)

| 整合點 | 測試時間 | 狀態 | 備註 |
|:---|:---:|:---:|:---|
| STT → NLP | P2.5 | ⏳ | 進行中 |
| NLP → MEM/LLM | P2.5 | ⏳ | 進行中 |
| MEM → LLM | P2.5 | ⏳ | 進行中 |
| LLM → SYS | P2.5 | ⏳ | 進行中 |
| LLM/SYS → TTS | P2.5 | 📅 | 規劃中 |
| Backend → Frontend | P2.5 | 📅 | 規劃中 |

#### 階段 3: 系統測試 (規劃中)

| 測試項目 | 測試時間 | 狀態 | 備註 |
|:---|:---:|:---:|:---|
| 系統啟動測試 | P2.5 完成後 | 📅 | - |
| CHAT 模式測試 | P2.5 完成後 | 📅 | - |
| WORK 模式測試 | P2.5 完成後 | 📅 | - |
| 錯誤處理測試 | P2.5 完成後 | 📅 | - |

#### 階段 4: 性能測試 (規劃中)

| 測試項目 | 測試時間 | 狀態 | 備註 |
|:---|:---:|:---:|:---|
| 啟動時間測試 | P2.6 | ✅ | 當前 ~37秒 |
| CHAT 回應時間 | P2.6 | 📅 | - |
| 記憶體使用測試 | P2.6 | 📅 | - |
| GPU 資源測試 | P2.6 | 📅 | - |

### 7.3 測試里程碑

| 里程碑 | 預定時間 | 驗收標準 | 狀態 |
|:---|:---:|:---|:---:|
| **TM1** | P2.5 完成後 | 所有單元測試通過 (覆蓋率 > 80%) | ⏳ |
| **TM2** | P2.5 完成後 | 整合測試通過 (關鍵整合點 100%) | 📅 |
| **TM3** | P2.6 開始前 | CHAT/WORK 系統測試通過 | 📅 |
| **TM4** | v2.0.0 發布前 | 性能測試達標 | 📅 |

---

## 8. 缺陷管理

### 8.1 缺陷分類

#### 按嚴重性分類

| 等級 | 名稱 | 定義 | 範例 | 處理時限 |
|:---:|:---|:---|:---|:---:|
| **Critical** | 嚴重 | 系統崩潰,核心功能失效 | 系統啟動失敗,CHAT 流程中斷 | 立即 |
| **High** | 高 | 重要功能異常,嚴重影響使用 | 記憶檢索失敗,LLM 無回應 | 1 天內 |
| **Medium** | 中 | 次要功能異常,有 workaround | UI 顯示錯誤,動畫卡頓 | 3 天內 |
| **Low** | 低 | 小問題,不影響主要功能 | 日誌格式錯誤,文字錯別字 | 1 週內 |

#### 按類型分類

| 類型 | 說明 | 範例 |
|:---|:---|:---|
| **Functional** | 功能性缺陷 | 功能未實現,邏輯錯誤 |
| **Performance** | 性能缺陷 | 回應慢,記憶體洩漏 |
| **UI/UX** | 介面缺陷 | 顯示錯誤,操作不順 |
| **Integration** | 整合缺陷 | 模組間協作失敗 |
| **Documentation** | 文檔缺陷 | 文檔錯誤,說明不清 |

### 8.2 缺陷追蹤流程

```
發現缺陷 → 記錄 (GitHub Issues) → 評估嚴重性 → 分派負責人 
    ↓
修復缺陷 → 程式碼審查 → 重新測試 → 驗證通過 → 關閉 Issue
    ↓ (未通過)
重新開啟 → 修復缺陷 (循環)
```

### 8.3 缺陷記錄格式

#### GitHub Issue 範本

```markdown
## 缺陷描述
簡短描述缺陷現象

## 重現步驟
1. 步驟 1
2. 步驟 2
3. ...

## 預期結果
描述正確的行為

## 實際結果
描述實際觀察到的錯誤行為

## 環境資訊
- OS: Windows 11
- Python: 3.10.x
- GPU: RTX 4060
- Commit: abc123

## 嚴重性
Critical / High / Medium / Low

## 附件
- 日誌檔案
- 截圖
- 錄影
```

### 8.4 缺陷統計

#### 當前缺陷狀態 (範例)

| 狀態 | Critical | High | Medium | Low | 總計 |
|:---|:---:|:---:|:---:|:---:|:---:|
| **Open** | 0 | 2 | 5 | 8 | 15 |
| **In Progress** | 0 | 1 | 2 | 1 | 4 |
| **Resolved** | 1 | 3 | 7 | 12 | 23 |
| **Closed** | 1 | 3 | 6 | 10 | 20 |

#### 缺陷趨勢追蹤

- **發現率**: 每週新增缺陷數
- **修復率**: 每週關閉缺陷數
- **積壓數**: 未關閉缺陷總數

**目標**:
- 修復率 > 發現率
- Critical/High 缺陷 24 小時內修復
- v2.0.0 發布前 Critical/High 缺陷歸零

---

## 附錄 A: 測試案例列表

### 單元測試案例索引

| 編號 | 測試名稱 | 模組 | 優先級 | 狀態 |
|:---|:---|:---:|:---:|:---:|
| TC-STT-001 | STT 基礎轉錄 | STT | P0 | ⏳ |
| TC-STT-002 | 說話者識別 | STT | P1 | ⏳ |
| TC-NLP-001 | CHAT 意圖識別 | NLP | P0 | ⏳ |
| TC-MEM-001 | 記憶存儲 | MEM | P0 | ⏳ |
| TC-MEM-002 | 身份隔離 | MEM | P1 | ⏳ |
| TC-LLM-001 | Gemini API 調用 | LLM | P0 | ⏳ |
| TC-SYS-001 | 工作流執行 | SYS | P0 | ⏳ |
| TC-TTS-001 | 語音合成 | TTS | P0 | ⏳ |
| TC-TTS-002 | 情緒控制 | TTS | P1 | ⏳ |

### 整合測試案例索引

| 編號 | 測試名稱 | 整合點 | 優先級 | 狀態 |
|:---|:---|:---:|:---:|:---:|
| TC-INT-001 | STT → NLP | Input Layer | P0 | ⏳ |
| TC-INT-002 | MEM → LLM | Processing Layer | P0 | ⏳ |
| TC-INT-003 | LLM → SYS | Processing Layer | P0 | ⏳ |

### 系統測試案例索引

| 編號 | 測試名稱 | 流程 | 優先級 | 狀態 |
|:---|:---|:---:|:---:|:---:|
| TC-SYS-001 | CHAT 端到端 | CHAT Mode | P0 | 📅 |
| TC-SYS-002 | WORK 端到端 | WORK Mode | P0 | 📅 |
| TC-SYS-003 | 系統啟動 | Initialization | P0 | ⏳ |

---

## 附錄 B: 測試報告範本

### 測試執行報告範本

```markdown
# 測試執行報告

## 基本資訊
- **報告日期**: YYYY-MM-DD
- **測試階段**: 單元測試 / 整合測試 / 系統測試
- **測試負責人**: Bernie
- **測試期間**: YYYY-MM-DD ~ YYYY-MM-DD

## 測試摘要
- **總測試案例數**: XX
- **通過**: XX
- **失敗**: XX
- **阻塞**: XX
- **未執行**: XX
- **通過率**: XX%

## 測試結果詳情
### 通過的測試
- TC-XXX-001: 測試名稱
- TC-XXX-002: 測試名稱

### 失敗的測試
| 案例編號 | 失敗原因 | 缺陷編號 | 嚴重性 |
|:---|:---|:---:|:---:|
| TC-XXX-003 | 描述 | #123 | High |

## 缺陷統計
- **Critical**: X 個
- **High**: X 個
- **Medium**: X 個
- **Low**: X 個

## 風險與建議
- 風險 1: 描述
- 建議 1: 描述

## 結論
總結測試結果與下一步行動
```

---

**文件完成日期**: 2025-11-07  
**測試負責人**: Bernie
**文件版本**: 1.0  
**下次更新**: 測試執行後
