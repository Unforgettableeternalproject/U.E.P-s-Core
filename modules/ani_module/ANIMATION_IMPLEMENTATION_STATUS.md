# å‹•ç•«å¯¦ç¾ç‹€æ…‹

æœ¬æ–‡æª”è¨˜éŒ„å„å‹•ç•«çš„å¯¦ç¾ç‹€æ…‹èˆ‡è§¸ç™¼é‚è¼¯ä½ç½®ã€‚

---

## âœ… å·²å®Œå…¨å¯¦ç¾çš„å‹•ç•«

### åŸºç¤å‹•ç•«
| å‹•ç•«åç¨± | å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|---------|---------|------|
| **enter** | `mov_module.py::_play_entry_animation()` | ç³»çµ±å•Ÿå‹•æ™‚ | âœ… å®Œå…¨å¯¦ç¾ |
| **smile_idle_f** | `mov_module.py::_on_entry_complete()` | æµ®ç©ºæ¨¡å¼é–’ç½® | âœ… å®Œå…¨å¯¦ç¾ |
| **stand_idle_g** | `mov_module.py::_on_entry_complete()` | åœ°é¢æ¨¡å¼é–’ç½® | âœ… å®Œå…¨å¯¦ç¾ |
| **struggle_f** | `mov_module.py::_on_drag_begin()` | ä½¿ç”¨è€…æ‹–æ›³æ™‚ | âœ… å®Œå…¨å¯¦ç¾ |

### ç§»å‹•å‹•ç•«
| å‹•ç•«åç¨± | å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|---------|---------|------|
| **walk_left_g** | `behaviors/movement_behavior.py` | åœ°é¢æ¨¡å¼å‘å·¦ç§»å‹• | âœ… å®Œå…¨å¯¦ç¾ |
| **walk_right_g** | `behaviors/movement_behavior.py` | åœ°é¢æ¨¡å¼å‘å³ç§»å‹• | âœ… å®Œå…¨å¯¦ç¾ |
| **turn_left_g** | `mov_module.py::_apply_boundaries()` | ç¢°åˆ°å³é‚Šç•Œè½‰å‘ | âœ… å®Œå…¨å¯¦ç¾ |
| **turn_right_g** | `mov_module.py::_apply_boundaries()` | ç¢°åˆ°å·¦é‚Šç•Œè½‰å‘ | âœ… å®Œå…¨å¯¦ç¾ |
| **turn_head_f** | `handlers/cursor_tracking_handler.py` | æµ®ç©ºæ™‚æ»‘é¼ é è¿‘ | âœ… å®Œå…¨å¯¦ç¾ |
| **turn_head_g** | `handlers/cursor_tracking_handler.py` | åœ°é¢æ™‚æ»‘é¼ é è¿‘ | âœ… å®Œå…¨å¯¦ç¾ |

### äº’å‹•å‹•ç•«
| å‹•ç•«åç¨± | å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|---------|---------|------|
| **tease_f** | `mov_module.py::_enter_behavior()` | æŠ•æ“²å¾Œèª¿çš®è¡Œç‚º | âœ… å®Œå…¨å¯¦ç¾ |
| **tease2_f** | `handlers/throw_handler.py` | æŠ•æ“²å¾Œèª¿çš®è¡Œç‚ºï¼ˆè®Šé«”ï¼‰ | âœ… å®Œå…¨å¯¦ç¾ï¼ˆé‚è¼¯å­˜åœ¨ä½†æœªä½¿ç”¨ï¼‰ |

### è½‰å ´å‹•ç•«
| å‹•ç•«åç¨± | å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|---------|---------|------|
| **g_to_f** | `behaviors/transition_behavior.py` | åœ°é¢â†’æµ®ç©ºè½‰æ› | âœ… å®Œå…¨å¯¦ç¾ |
| **f_to_g** | `behaviors/transition_behavior.py` | æµ®ç©ºâ†’åœ°é¢è½‰æ› | âœ… å®Œå…¨å¯¦ç¾ |

---

## ğŸŸ¡ éƒ¨åˆ†å¯¦ç¾çš„å‹•ç•«ï¼ˆä¾è³´ç³»çµ±å¾ªç’°ï¼‰

### ç³»çµ±å¾ªç’°å±¤ç´šå‹•ç•«
| å‹•ç•«åç¨± | å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|---------|---------|------|
| **data_processing_f** | `mov_module.py::_handle_layer_animation()` | è¼¸å…¥å±¤ï¼ˆæµ®ç©ºï¼‰ | ğŸŸ¡ é‚è¼¯å­˜åœ¨ï¼Œä¾è³´ç³»çµ±å¾ªç’°äº‹ä»¶ |
| **data_processing_g** | `mov_module.py::_handle_layer_animation()` | è¼¸å…¥å±¤ï¼ˆåœ°é¢ï¼‰ | ğŸŸ¡ é‚è¼¯å­˜åœ¨ï¼Œä¾è³´ç³»çµ±å¾ªç’°äº‹ä»¶ |
| **thinking_f** | `mov_module.py::_handle_layer_animation()` | è™•ç†å±¤ï¼ˆæµ®ç©ºï¼‰ | ğŸŸ¡ é‚è¼¯å­˜åœ¨ï¼Œä¾è³´ç³»çµ±å¾ªç’°äº‹ä»¶ |
| **thinking_g** | `mov_module.py::_handle_layer_animation()` | è™•ç†å±¤ï¼ˆåœ°é¢ï¼‰ | ğŸŸ¡ é‚è¼¯å­˜åœ¨ï¼Œä¾è³´ç³»çµ±å¾ªç’°äº‹ä»¶ |
| **talk_ani_f** | `mov_module.py::_handle_layer_animation()` | è¼¸å‡ºå±¤ï¼Œmood > 0 | ğŸŸ¡ é‚è¼¯å­˜åœ¨ï¼Œä¾è³´ç³»çµ±å¾ªç’°äº‹ä»¶ |
| **talk_ani2_f** | `mov_module.py::_handle_layer_animation()` | è¼¸å‡ºå±¤ï¼Œmood â‰¤ 0 | ğŸŸ¡ é‚è¼¯å­˜åœ¨ï¼Œä¾è³´ç³»çµ±å¾ªç’°äº‹ä»¶ |

**èªªæ˜**ï¼šé€™äº›å‹•ç•«çš„è§¸ç™¼é‚è¼¯å·²å®Œæˆï¼Œä½†éœ€è¦ç³»çµ±å¾ªç’°æ¨¡çµ„ï¼ˆController/StateManagerï¼‰ç™¼é€å±¤ç´šåˆ‡æ›äº‹ä»¶æ‰æœƒè§¸ç™¼ã€‚

**è§¸ç™¼æ–¹å¼**ï¼š
- éœ€è¦ Controller èª¿ç”¨ `MOV.handle_frontend_request({"type": "layer_change", "layer": "input/processing/output"})`
- æˆ–é€é EventBus ç™¼é€å±¤ç´šè®Šæ›´äº‹ä»¶

---

## âŒ æœªå¯¦ç¾çš„å‹•ç•«

### æƒ…ç·’é–’ç½®å‹•ç•«ï¼ˆéœ€è¦ mood/pride ç³»çµ±æ•´åˆï¼‰
| å‹•ç•«åç¨± | æ‡‰å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|-----------|---------|------|
| **angry_idle_f** | å¾…å¯¦ç¾ | mood < é–¾å€¼ ä¸” pride > é–¾å€¼ | âŒ æœªå¯¦ç¾ |
| **awkward_f** | å¾…å¯¦ç¾ | mood > é–¾å€¼ ä¸” pride < é–¾å€¼ | âŒ æœªå¯¦ç¾ |
| **curious_idle_f** | å¾…å¯¦ç¾ | mood > é–¾å€¼ ä¸” pride > é–¾å€¼ | âŒ æœªå¯¦ç¾ |
| **laugh_f** | å¾…å¯¦ç¾ | è¼¸å‡ºå±¤ï¼ŒCS å­˜åœ¨ï¼Œç‰¹å®šæ¢ä»¶ | âŒ æœªå¯¦ç¾ |

**å¯¦ç¾å»ºè­°**ï¼š
1. åœ¨ `_handle_idle_animation()` ä¸­æ·»åŠ  mood/pride æª¢æŸ¥
2. å¾ `status_manager.status` ç²å–æƒ…ç·’å€¼
3. æ ¹æ“šé–¾å€¼é¸æ“‡å°æ‡‰å‹•ç•«

### å½©è›‹å‹•ç•«ï¼ˆéœ€è¦éš¨æ©Ÿè§¸ç™¼ç³»çµ±ï¼‰
| å‹•ç•«åç¨± | æ‡‰å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|-----------|---------|------|
| **dance_f** | å¾…å¯¦ç¾ | é–’ç½®ä¸­éš¨æ©Ÿå‡ºç¾ï¼ˆæµ®ç©ºï¼‰ | âŒ æœªå¯¦ç¾ |
| **dance2_g** | å¾…å¯¦ç¾ | é–’ç½®ä¸­éš¨æ©Ÿå‡ºç¾ï¼ˆåœ°é¢ï¼‰ | âŒ æœªå¯¦ç¾ |
| **chilling_f** | å¾…å¯¦ç¾ | æœ€è¿‘æ’­æ”¾éŸ³æ¨‚å¾Œé–’ç½® | âŒ æœªå¯¦ç¾ |
| **yawn_g** | å¾…å¯¦ç¾ | boredom > é–¾å€¼æ™‚é–’ç½® | âŒ æœªå¯¦ç¾ |

**å¯¦ç¾å»ºè­°**ï¼š
1. åœ¨ `behaviors/idle_behavior.py` çš„ `execute()` ä¸­æ·»åŠ éš¨æ©Ÿè§¸ç™¼
2. ä½¿ç”¨ `anim_query.get_easter_egg_animation(is_ground)` ç²å–å½©è›‹å‹•ç•«
3. è¨­å®šè§¸ç™¼æ©Ÿç‡ï¼ˆå¦‚ 5% æ¯æ¬¡ idle tickï¼‰

### æ¨å‹•å‹•ç•«ï¼ˆéœ€è¦æ‹–æ›³æ–¹å‘æª¢æ¸¬ï¼‰
| å‹•ç•«åç¨± | æ‡‰å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|-----------|---------|------|
| **push_down** | å¾…å¯¦ç¾ | æ‹–æ›³å¾€ä¸‹æ™‚ | âŒ æœªå¯¦ç¾ |
| **push_up** | å¾…å¯¦ç¾ | æ‹–æ›³å¾€ä¸Šæ™‚ | âŒ æœªå¯¦ç¾ |
| **push_left** | å¾…å¯¦ç¾ | æ‹–æ›³å¾€å·¦æ™‚ | âŒ æœªå¯¦ç¾ |
| **push_right** | å¾…å¯¦ç¾ | æ‹–æ›³å¾€å³æ™‚ | âŒ æœªå¯¦ç¾ |

**å¯¦ç¾å»ºè­°**ï¼š
1. åœ¨ `_on_drag_move()` ä¸­è¨ˆç®—æ‹–æ›³æ–¹å‘
2. æ ¹æ“šæ–¹å‘ä½¿ç”¨ `anim_query.get_push_animation(direction)` ç²å–å‹•ç•«
3. æ›¿æ›ç•¶å‰çš„ `struggle` å‹•ç•«

### æª”æ¡ˆäº’å‹•å‹•ç•«ï¼ˆéœ€è¦æª”æ¡ˆæ‹–æ”¾äº‹ä»¶ï¼‰
| å‹•ç•«åç¨± | æ‡‰å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|-----------|---------|------|
| **take_file_f** | å¾…å¯¦ç¾ | æª”æ¡ˆæ‹–æ”¾åˆ°çª—å£ï¼ˆæµ®ç©ºï¼‰ | âŒ æœªå¯¦ç¾ |
| **take_file_g** | å¾…å¯¦ç¾ | æª”æ¡ˆæ‹–æ”¾åˆ°çª—å£ï¼ˆåœ°é¢ï¼‰ | âŒ æœªå¯¦ç¾ |

**å¯¦ç¾å»ºè­°**ï¼š
1. åœ¨ UI æ¨¡çµ„ç›£è½æª”æ¡ˆæ‹–æ”¾äº‹ä»¶
2. ç™¼é€äº‹ä»¶çµ¦ MOV æ¨¡çµ„
3. åœ¨è™•ç†å±¤å‹•ç•«é‚è¼¯ä¸­æ·»åŠ æª”æ¡ˆè™•ç†åˆ†æ”¯

### å…¶ä»–æœªä½¿ç”¨å‹•ç•«
| å‹•ç•«åç¨± | æ‡‰å¯¦ç¾ä½ç½® | è§¸ç™¼æ¢ä»¶ | ç‹€æ…‹ |
|---------|-----------|---------|------|
| **leave** | å¾…å¯¦ç¾ | ç³»çµ±é—œé–‰æ™‚ | âŒ æœªå¯¦ç¾ |
| **click_f** | å¾…å¯¦ç¾ | é»æ“Šæª”æ¡ˆ/æ‡‰ç”¨ç¨‹å¼ | âŒ æœªå¯¦ç¾ï¼ˆæš«æ™‚åœç”¨ï¼‰ |
| **turn_walk_g** | å¾…å¯¦ç¾ | é‚Šèµ°é‚Šè½‰å‘ï¼Ÿ | âŒ æœªå¯¦ç¾ï¼ˆç”¨é€”ä¸æ˜ï¼‰ |
| **sleep_l** | å¾…å¯¦ç¾ | ç¡çœ ç‹€æ…‹é–’ç½® | âŒ æœªå¯¦ç¾ |
| **g_to_l** | å¾…å¯¦ç¾ | åœ°é¢â†’ç¡çœ è½‰æ› | âŒ æœªå¯¦ç¾ |
| **l_to_g** | å¾…å¯¦ç¾ | ç¡çœ â†’åœ°é¢è½‰æ› | âŒ æœªå¯¦ç¾ |

---

## ğŸ“ å¯¦ç¾å„ªå…ˆç´šå»ºè­°

### P0 - æ ¸å¿ƒé«”é©—ï¼ˆå·²å®Œæˆï¼‰
- âœ… åŸºç¤é–’ç½®å‹•ç•«ï¼ˆsmile_idle_f, stand_idle_gï¼‰
- âœ… æ‹–æ›³å‹•ç•«ï¼ˆstruggle_fï¼‰
- âœ… ç§»å‹•å‹•ç•«ï¼ˆwalk_left_g, walk_right_g, turn_*ï¼‰
- âœ… æ»‘é¼ è·Ÿéš¨å‹•ç•«ï¼ˆturn_head_*ï¼‰
- âœ… å…¥å ´å‹•ç•«ï¼ˆenterï¼‰

### P1 - ç³»çµ±æ•´åˆï¼ˆéƒ¨åˆ†å®Œæˆï¼‰
- ğŸŸ¡ ç³»çµ±å¾ªç’°å±¤ç´šå‹•ç•«ï¼ˆéœ€è¦äº‹ä»¶è§¸ç™¼ï¼‰
- âŒ å‡ºå ´å‹•ç•«ï¼ˆleaveï¼‰

### P2 - è±å¯Œé«”é©—
- âŒ æ¨å‹•å‹•ç•«ï¼ˆpush_*ï¼‰- æ›¿æ› struggle
- âŒ å½©è›‹å‹•ç•«ï¼ˆdance_*, yawn_gï¼‰- å¢åŠ è¶£å‘³æ€§
- âŒ æƒ…ç·’é–’ç½®å‹•ç•«ï¼ˆangry_*, curious_*, awkward_*ï¼‰- æƒ…æ„Ÿè¡¨é”

### P3 - é€²éšåŠŸèƒ½
- âŒ æª”æ¡ˆäº’å‹•å‹•ç•«ï¼ˆtake_file_*ï¼‰
- âŒ ç¡çœ ç³»çµ±ï¼ˆsleep_l, g_to_l, l_to_gï¼‰
- âŒ éŸ³æ¨‚ç›¸é—œï¼ˆchilling_fï¼‰

---

## ğŸ”§ å¿«é€Ÿå¯¦ç¾æŒ‡å—

### 1. å•Ÿç”¨ç³»çµ±å¾ªç’°å±¤ç´šå‹•ç•«
åœ¨ Controller ä¸­æ·»åŠ ï¼š
```python
# ç•¶é€²å…¥è¼¸å…¥å±¤æ™‚
self.mov_module.handle_frontend_request({
    "type": "layer_change",
    "layer": "input"
})

# ç•¶é€²å…¥è™•ç†å±¤æ™‚
self.mov_module.handle_frontend_request({
    "type": "layer_change",
    "layer": "processing"
})

# ç•¶é€²å…¥è¼¸å‡ºå±¤æ™‚
self.mov_module.handle_frontend_request({
    "type": "layer_change",
    "layer": "output"
})
```

### 2. å¯¦ç¾å½©è›‹å‹•ç•«
åœ¨ `behaviors/idle_behavior.py` çš„ `execute()` ä¸­æ·»åŠ ï¼š
```python
import random

# 5% æ©Ÿç‡è§¸ç™¼å½©è›‹
if random.random() < 0.05:
    is_ground = (ctx.movement_mode == MovementMode.GROUND)
    easter_egg = ctx.anim_query.get_easter_egg_animation(is_ground)
    if easter_egg:
        ctx.trigger_anim(easter_egg, {"loop": False})
        return
```

### 3. å¯¦ç¾æ¨å‹•å‹•ç•«
åœ¨ `mov_module.py::_on_drag_move()` ä¸­ï¼š
```python
# è¨ˆç®—æ‹–æ›³æ–¹å‘
dx = new_x - self.position.x
dy = new_y - self.position.y

if abs(dx) > abs(dy):
    direction = "right" if dx > 0 else "left"
else:
    direction = "down" if dy > 0 else "up"

# ä½¿ç”¨æ¨å‹•å‹•ç•«æ›¿ä»£æ™æ‰å‹•ç•«
push_anim = self.anim_query.get_push_animation(direction)
self._trigger_anim(push_anim, {"loop": True})
```

---

## æœ€å¾Œæ›´æ–°
- æ—¥æœŸï¼š2025-11-25
- å®Œæˆåº¦ï¼š**17/41 å‹•ç•«å·²å¯¦ç¾** (41%)
- æ ¸å¿ƒåŠŸèƒ½å®Œæˆåº¦ï¼š**100%**
