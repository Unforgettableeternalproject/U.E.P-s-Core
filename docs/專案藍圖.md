# U.E.P Core 專案藍圖

Unified Experience Partner (U.E.P) 是一個模組化設計的桌面互動助理系統，結合語音輸入、自然語言理解、大型語言模型推理、情境記憶處理、語音合成與桌面控制等能力，旨在提供自然、直覺、並具個性化的使用體驗。

---

## 一、系統核心架構總覽

```
[User] ─► STT✅ ─► NLP🔧 ─► LLM📋 + MEM📋 ─► SYS📋 + TTS📋 ─► UI📋 (overlay)
                                     ▲                    ▼
                                   Snapshot             Voice Output
                                     ▼                    ▼
                              Memory Flow📋            MOV📋 + ANI📋

圖例：✅已完成 🔧重構中 📋待重構
```

U.E.P 的整體流程包含語音轉文字、指令/聊天辨識、語意推論、功能執行、視覺表現、語音回饋與互動動作六個主要階段，並以模組化形式進行開發與擴充。

---

## 二、模組設計概述與發展路線

### 1. STT Module ✅

* **重構完成狀態**：✅ **已重構** - 採用 Transformers Whisper + pyannote 架構
* **核心技術棧**：
  * **語音識別**：Transformers Whisper Large V3 模型 (本地GPU加速)
  * **語音活動檢測**：pyannote-based VAD + 基於能量的備用實現
  * **說話人識別**：pyannote/speaker-diarization-3.1 嵌入模型
  * **音訊處理**：PyAudio + 即時音訊流處理

* **完成功能**：
  * ✅ 即時語音轉文字 (支援持續監聽模式)
  * ✅ 高精度說話人識別與語者分離
  * ✅ 智能語音活動檢測 (VAD) - 自動檢測語音開始/結束
  * ✅ 多語者樣本累積與自動建檔
  * ✅ 與核心框架完全整合 (支援動態路由)
  * ✅ 生產環境就緒 (健康檢查、錯誤處理、狀態管理)

* **架構亮點**：
  * **模組化設計**：VAD、Speaker、Whisper 各自獨立又協同工作
  * **說話人學習**：自動累積語者樣本，支援高相似度辨識
  * **GPU 優化**：CUDA 加速，提供低延遲實時處理
  * **容錯機制**：多層級錯誤處理與自動降級策略

### 2. NLP Module 🔧

* **重構狀態**：🔧 **準備重構** - 目前使用舊架構，即將進行全面重構
* **目前狀態**：使用 DistilBERT 分類聊天 / 指令 / 無效輸入
* **重構規劃**：

  * **意圖分類升級**：整合更先進的 NLP 模型，提升分類精確度
  * **多輪對話理解**：支援上下文語境理解與對話狀態追蹤
  * **聊天主題辨識**：自動topic labeling與對話摘要生成
  * **實體抽取**：從語音輸入中抽取關鍵實體 (檔案名稱、程式名稱等)
  * **與STT整合**：利用說話人識別結果進行個性化語言理解
  * **語義路由**：為LLM提供更精確的上下文與任務分類
  * **核心框架整合**：採用統一的模組介面與動態路由機制

### 3. MEM Module

* **目前狀態**：RAG + 本地檔案紀錄，記憶摘要回傳給 LLM
* **未來擴充**：

  * 快照管理與主題鏈結（動態追蹤上下文）
  * 建立短期記憶（快取）與長期記憶（資料庫）分層架構
  * 根據 NLP 標記選取最適摘要範圍回傳給 LLM

### 4. LLM Module

* **目前狀態**：與 Gemini 2.0 Flash API 串接，具 System Prompt
* **未來擴充**：

  * 輸入參數化：狀態、任務類型、聊天快照、語者屬性
  * 輸出參數化（JSON）：語氣情緒、SYS 任務、TTS 模式等
  * 支援多模型策略（本地微調 vs 雲端推理）

### 5. TTS Module

* **目前狀態**：Edge TTS 預處理 + RVC 聲音轉換，具 API 架構
* **技術瓶頸**：語速與語調控制不足，處理延遲偏高
* **未來改進**：

  * 最佳化語音生成流程，支援非同步佇列處理
  * 支援語者風格/情緒輸入參數（由 LLM 提供）
  * 預計支援記憶化語者模型（可隨個人風格成長）

### 6. SYS Module

* **目前狀態**：基礎檔案建立、刪除、查找功能
* **未來擴充**：

  * 支援網頁搜尋、行事曆、代辦事項
  * 整合 LLM 系統推理判斷（必要時請求協助）
  * 支援與 TTS/UI 同步運作的時間型任務執行

### 7. UI Module

* **目前狀態**：尚未建立
* **第一階段目標**：建立桌面透明應用 + 放置圖片
* **未來擴充**：

  * 整合使用者控制面板 / 狀態切換頁面
  * 除錯模式面板（顯示 CORE debug log）
  * 管理 overlay、動畫播放與互動區域

### 8. MOV Module

* **目前狀態**：尚未建立
* **階段性目標**：

  1. 控制 U.E.P 視覺物件在桌面移動
  2. 根據輸出內容影響桌面物件（如推開視窗）
  3. 監控滑鼠位置進行追蹤與迴避

### 9. ANI Module

* **目前狀態**：尚未建立
* **任務目標**：

  * 同步動畫與系統事件（語音播報時嘴型動作等）
  * 根據核心狀態（工作、聊天等）切換主動畫序列
  * 支援動畫素材擴充與特效疊加（如心情指數變化）

---

## 三、U.E.P 核心控制層（Core Layer）

### 功能責任：

* 控制模組之間的串接與任務流向
* 管理 U.E.P 的五種狀態（idle, chat, work, mischievous\*, error）
* 收集各模組 log 與執行 trace，協助除錯與統計
* 管理系統模式（例如 單人 vs 多人 / 本地 vs 雲端 / 安靜模式）

### 檔案結構：

| 檔案                 | 功能說明                 |
| ------------------ | -------------------- |
| `controller.py`    | 主任務處理流程控制與資料流串接邏輯    |
| `router.py`        | 模組任務路由與任務類型分派處理器（可選） |
| `registry.py`      | 模組註冊、初始化、動態呼叫模組      |
| `state_manager.py` | 狀態機控管目前情境、主動畫邏輯切換    |

---

## 四、後續擴充方向建議

* 🤖 支援 Plugin 式外掛功能（類似 Copilot Plugin 設計）
* 📦 模組熱插拔與動態重新載入（搭配 `registry.py`）
* 🎤 本地語音模型 / Whisper-VAD 整合（離線體驗）
* 🧠 使用者模型個性建構（連動 MEM，支援人格成長）
* 📈 整合任務追蹤與系統分析統計模組（可視化）

---

> 本藍圖為 U.E.P Core 系統 2025 年第二季開發起點，後續將根據模組實作進度與技術演進持續修訂。
