# U.E.P Phase 2 模組重構與前後端整合規劃

---

## 核心六大模組重構重點

### 1. STT（語音辨識模組）

* 加入感應式錄音（Always-on/VAD），可無需明確指令自動啟動語音辨識。
* 支援多使用者語音識別，聲音與使用者身份關聯，便於個人化記憶管理。
* 考慮 Whisper/Local Whisper-VAD 方案，提升雜訊環境下的辨識穩定性與即時性。

### 2. NLP（自然語言理解模組）

* 強化主題與快照標註：動態產生對話主題，並能建立對話快照。
* 支援複合意圖解析：可同時解析 chat/command 等多層意圖。
* 與 SYS 模組功能列表聯動，讓指令分析更精準且能自動補全參數。

### 3. MEM（記憶管理模組）

* 記憶快取分層：設計短期快取與長期記憶資料庫。
* 動態主題切換與快照召回：根據當前對話主題自動切換快照。
* Chunk & Summarize 優化：內容自動切分摘要以強化 LLM prompt 管理。
* 提供快照存取 API，便於 UI/LLM/使用者操作歷史記憶。

### 4. LLM（大型語言模型模組）

* 輸入/輸出參數化：結構化傳遞聊天、指令、主題、情緒等上下文訊息。
* 整合 Gemini Context Caching：減少 token 消耗，優化多輪對話邏輯。
* function-calling 標準化，與 SYS 功能清單自動串接。
* 完整日誌及異常處理，API 故障可自動 fallback。
* 互動式 (與SYS) 工作流程

### 5. TTS（語音合成模組）

* 語音情緒控制優化：可根據 LLM/用戶 mood 動態改變語音特質（語速/語調/濾鏡）。
* 支援本地/雲端合成自動切換與多聲線。

### 6. SYS（系統功能控制模組）

* 功能清單 YAML/JSON 化，全面支援查詢與自動產生參數說明（for LLM function-calling）。
* 支援多工背景任務（提醒、資料夾監控等）。
* 動態功能註冊/移除機制，便於模組熱插拔。
* 提供前後端解耦 API，支援 UI/MOV/ANI 直接呼叫。
* 剪貼簿、檔案互動、外部整合能力擴充（含 OCR、程式碼分析等）。

---

## 前端三大模組規劃

### 7. UI（用戶互動介面模組）

* 桌面 Overlay UI，提供拖放、按鈕、狀態指示等可視化操作。
* 與核心狀態、工作流程同步，能即時反映 U.E.P 狀態切換。
* 彈性框架設計，支援主動提示、通知、互動回饋等。
* 可自動生成功能表（根據 SYS functions.yaml），引導用戶操作。

### 8. MOV（動畫移動/桌面行為模組）

* 控管桌面角色的移動、位置、與視窗/圖示/螢幕區塊之間的互動。
* 支援 idle/chat/work/error 等多狀態對應的動作模式。
* 接收 UI/LLM/SYS 訊息調整角色行為。
* 支援手動拖曳、碰撞回饋與基礎物理效果。

### 9. ANI（動畫表現模組）

* 管理桌面角色所有關鍵動畫、動作切換與狀態過場特效。
* 與 MOV/UI 狀態同步，根據情境自動切換動畫（如 happy/sad/idle/error）。
* 開放動態資源更新，便於日後主題包或自定角色擴充。

---

## 前後端整合與開發協作重點

* **功能呼叫標準化**：所有系統功能均有明確 schema（functions.yaml/JSON），可供 UI/LLM 讀取自動生成介面或對話指令。
* **狀態同步設計**：UI 及動畫皆與核心 StateManager/Routing 保持同步，保證使用者操作與助理狀態一致。
* **開發測試規範**：後端先用 CLI/自動化測試穩定流程，前端再逐步串接互動事件。
* **模組熱更新/動態註冊**：可依需求動態加載、移除功能，提升擴充彈性。
* **全模組日誌與錯誤追蹤**：前後端皆統一記錄關鍵操作，方便除錯與分析。

---

## 目標成果

* 六大核心模組完成重構並標準化 API/Schema
* 前端（UI/MOV/ANI）雛型能與後端溝通，支援桌面角色基本互動與任務流
* 支援 LLM function-calling，能自動引導用戶進行多階段複雜操作
* 提供功能完整的 YAML/JSON 規格書與全模組自動化測試

---
