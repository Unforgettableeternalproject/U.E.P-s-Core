# U.E.P System Module Workflow Definitions
#
# 這個文件定義了所有可用的工作流，包括：
# - 工作流的基本信息（名稱、描述、分類）
# - 可接受的初始參數（用於工作流加速）
# - MCP Tool 生成所需的參數定義
#
# 初始參數機制：
# - LLM 可以從用戶輸入中提取初始參數
# - 如果提供了初始參數，工作流會跳過相應的互動步驟
# - 這使得工作流能夠更快速地響應用戶需求
#
# 注意：file_selection 類型的參數暫時保持 optional: false
#       未來會在前端紙盒實現後改為 optional: true

workflows:
  # ==================== File Workflows ====================
  
  drop_and_read:
    name: "drop_and_read"
    description: "Read file content and provide summary using LLM"
    category: "file"
    work_mode: "direct"
    
    initial_params: {}

    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: file_path_input (optional file path)"

  intelligent_archive:
    name: "intelligent_archive"
    description: "Archive files to organized folders using LLM suggestions"
    category: "file"
    work_mode: "direct"
    
    initial_params:
      target_dir_input:
        type: str
        optional: true
        description: "Target directory for archiving (optional, LLM will suggest if not provided)"
        maps_to_step: "target_dir_input"
        extraction_hint: "Extract directory paths from phrases like archive to Documents, move to folder X"
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: file_selection (required), target_dir_input (optional)"

  summarize_tag:
    name: "summarize_tag"
    description: "Generate summary and tags for a file using LLM"
    category: "file"
    work_mode: "direct"
    
    initial_params:
      num_tags:
        type: int
        optional: true
        description: "Number of tags to generate (default: 3)"
        maps_to_step: "tag_count_input"
        extraction_hint: "Extract numbers from phrases like generate 10 tags, 5 keywords"
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: file_path_input (required), num_tags (default: 5)"

  translate_document:
    name: "translate_document"
    description: "Translate text documents (TXT, MD) to target language using LLM"
    category: "file"
    work_mode: "direct"
    
    initial_params:
      target_language:
        type: str
        optional: false
        description: "Target language (e.g., English, 日本語, 한국어)"
        maps_to_step: "target_language"
        extraction_hint: "Extract target language from user input (English, Japanese, Korean, etc.)"
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: file_path_input (required), target_language (optional)"

  ocr_extract:
    name: "ocr_extract"
    description: "Extract text from images using OCR (supports Chinese Traditional and English)"
    category: "file"
    work_mode: "direct"
    
    initial_params: {}
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: file_path_input (required)"

  # ==================== Info Workflows ====================
  
  get_weather:
    name: "get_weather"
    description: "Get weather information for a specific location using wttr.in API"
    category: "info"
    work_mode: "direct"
    
    initial_params:
      location:
        type: str
        optional: true
        description: "City name or location (supports Chinese or English)"
        maps_to_step: "location_input"
        extraction_hint: "Extract location/city names from user input, e.g., Tokyo, Taipei, 台北"
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: location (optional, Chinese or English city name)"

  get_world_time:
    name: "get_world_time"
    description: "Get current time in different timezones: UTC, specific timezone, or local time"
    category: "info"
    work_mode: "direct"
    
    initial_params:
      target_num:
        type: int
        optional: true
        description: "Time query mode: 1=UTC, 2=specific timezone, 3=local time"
        maps_to_step: "mode_selection"
        extraction_hint: "If query mentions specific location/timezone (Tokyo, New York, etc.) → 2. If asks for UTC → 1. If asks for local/current time → 3. Default to 2 if location mentioned."
        infer_from:
          - param: "tz"
            condition: "exists"
            value: 2
            reason: "If timezone is provided, mode must be 2 (specific timezone)"
      
      tz:
        type: str
        optional: true
        description: "Timezone name (e.g., Tokyo, Taiwan, New York) - only needed when target_num=2"
        maps_to_step: "timezone_input"
        extraction_hint: "Extract location/city names from query (Tokyo, New York, Taipei, 東京, etc.). Required when target_num=2."
        condition: "target_num == 2"
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: target_num (1=UTC, 2=timezone, 3=local), tz (timezone name for mode 2)"

  news_summary:
    name: "news_summary"
    description: "Quick peek at latest Taiwan news headlines (6 items) from Google News Taiwan. LLM will summarize headlines in English."
    category: "info"
    work_mode: "direct"
    
    initial_params: {}  # No parameters needed - fixed source and count
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"

  # ==================== Text Workflows ====================
  
  clipboard_tracker:
    name: "clipboard_tracker"
    description: "Search clipboard history (max 5 recent items) and copy selected item. Requires background monitoring service."
    category: "text"
    work_mode: "direct"
    
    initial_params:
      keyword:
        type: str
        optional: true
        description: "Search keyword (empty to view all recent history, max 5 items)"
        maps_to_step: "input_keyword"
        extraction_hint: "Extract search terms from user input (e.g., search for email, find phone number)"
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: keyword (optional search keyword, empty for all history)"

  quick_phrases:
    name: "quick_phrases"
    description: "Generate text templates using LLM and save as file to desktop (letters, resumes, emails, etc.)"
    category: "text"
    work_mode: "direct"
    
    initial_params:
      template_request:
        type: str
        optional: true
        description: "Description of the template needed (e.g., business email, cover letter, meeting agenda, thank you note)"
        maps_to_step: "input_template_request"
        extraction_hint: "Extract template type/purpose from user input: email, letter, resume, cover letter, meeting agenda, thank you note, apology letter, etc."
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: template_request (optional, description of template type)"

  # ==================== Analysis Workflows ====================
  
  code_analysis:
    name: "code_analysis"
    description: "Analyze code file using LLM with flexible analysis focus (security, performance, quality, etc.)"
    category: "analysis"
    work_mode: "direct"
    
    initial_params:
      analysis_focus:
        type: str
        optional: false
        description: "Analysis focus/goal (e.g., security, performance, code quality). Leave empty for general analysis."
        maps_to_step: "input_analysis_focus"
        extraction_hint: "Extract analysis intent from user input: security vulnerabilities, performance optimization, code quality, best practices, etc."
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: file_path_input (required), analysis_focus (optional, for flexible analysis goals)"

  # ==================== Utility Workflows ====================
  
  clean_trash_bin:
    name: "clean_trash_bin"
    description: "Clean system trash bin/recycle bin (supports Windows, macOS, Linux)"
    category: "utility"
    work_mode: "direct"
    
    initial_params: {}
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "No additional data needed"

  # ==================== Automation Workflows (Background) ====================
  
  media_playback:
    name: "media_playback"
    description: "Local music playback with background monitoring. Supports shuffle and smart loop mode (auto-infers single-song loop or playlist loop based on query). Task ends when: 1) Specific song finishes (without loop), 2) Playlist finishes (without loop), 3) User manually stops (with loop enabled)."
    category: "automation"
    work_mode: "background"
    
    initial_params:
      query:
        type: str
        optional: false
        description: "Song name to play (empty string \"\" means play entire music folder)"
        # maps_to_step: "query_input"  # ❌ Removed: background workflows cannot have Interactive steps
        extraction_hint: "**REQUIRED** - Always extract and provide query parameter. Extract song name from user input. Examples: 'play Jay Chou' → query='Jay Chou', 'play Something just like this' → query='Something just like this'. If user wants to play ALL music or doesn't specify a song (e.g., 'play my music', 'play local music', 'play some music'), provide empty string: query=''. **ALWAYS provide query parameter, never omit it**."
      
      shuffle:
        type: bool
        optional: true
        description: "Enable shuffle/random playback"
        maps_to_step: "shuffle"
        extraction_hint: "Return true if user mentions shuffle/random, otherwise false"
      
      loop:
        type: bool
        optional: true
        description: "Enable loop/repeat playback. System will intelligently choose: (1) Single-song loop if query is provided, (2) Playlist loop if query is empty."
        maps_to_step: "loop"
        extraction_hint: "Return true if user mentions loop/repeat/循環/重複, otherwise false. System automatically selects appropriate loop mode (single-song or playlist) based on context."
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: true
        description: "Initial data with REQUIRED 'query' field. Format: {\"query\": \"song name or empty string\", \"shuffle\": bool (optional), \"loop\": bool (optional)}. The 'query' field is REQUIRED - use empty string \"\" if user wants to play all music."
  
  control_media:
    name: "control_media"
    description: "Control active local music playback: play, pause, stop, next, previous, search, shuffle on/off, loop on/off (intelligently switches between single-song and playlist loop based on playback type), stop_service"
    category: "automation"
    work_mode: "direct"
    
    initial_params:
      task_id:
        type: str
        optional: true
        description: "Task ID of the running media playback workflow (auto-detected if not provided)"
        maps_to_step: "task_id"
        extraction_hint: "Usually auto-detected from active workflows. Only extract if user explicitly mentions a task ID."
      
      control_action:
        type: str
        optional: false
        description: "Control action: play, pause, stop, next, previous, search, shuffle, loop, stop_service. Loop intelligently selects mode based on playback type."
        maps_to_step: "control_action"
        extraction_hint: "CRITICAL: Extract the control command: 'pause' for pause/暫停, 'stop' for stop/停止, 'next' for next song/下一首, 'previous' for previous song/上一首, 'search' for search/搜尋, 'shuffle' for shuffle/隨機, 'loop' for loop/循環 (system auto-selects single-song or playlist loop), 'stop_service' for stop service/停止服務"
      
      control_params:
        type: dict
        optional: true
        description: "Additional parameters (e.g., song_query for search). For loop action, system auto-infers appropriate mode based on current playback type."
        maps_to_step: "control_params"
        extraction_hint: "For search: {'song_query': 'song name'}. For shuffle: {'shuffle': true/false}. For loop: {} (empty, system handles intelligent mode selection). For other actions: {}"
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: task_id (optional), control_action (required), control_params (optional)"

  generate_backup_script:
    name: "generate_backup_script"
    description: "Generate system backup script (.bat/.sh) for automated file backup. Future: will include UEP's personalized user cognition and preferences."
    category: "automation"
    work_mode: "background"
    
    initial_params:
      target_folder:
        type: str
        optional: false
        description: "Folder to backup (source folder)"
        maps_to_step: "target_folder"
        extraction_hint: "Extract source folder paths from: backup Documents, backup from C:\\Users\\, etc."
      
      dest_folder:
        type: str
        optional: false
        description: "Backup destination folder"
        maps_to_step: "dest_folder"
        extraction_hint: "Extract destination paths from: to D:\\Backup, save to external drive, etc."
      
      output_path:
        type: str
        optional: true
        description: "Script output path (default: Desktop/backup_script.bat or .sh)"
        maps_to_step: "output_path"
        extraction_hint: "Extract script save location, default to Desktop if not specified"
    
    mcp_tool_params:
      command:
        type: string
        required: true
        description: "User original command"
      initial_data:
        type: object
        required: false
        description: "Initial data: target_folder (required), dest_folder (required), output_path (optional)"
